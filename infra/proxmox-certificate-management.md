{"payload":{"allShortcutsEnabled":true,"fileTree":{"infra":{"items":[{"name":"proxmox-api.md","path":"infra/proxmox-api.md","contentType":"file"},{"name":"proxmox-certificate-management.md","path":"infra/proxmox-certificate-management.md","contentType":"file"},{"name":"proxmox-terraform.md","path":"infra/proxmox-terraform.md","contentType":"file"},{"name":"proxmox.md","path":"infra/proxmox.md","contentType":"file"},{"name":"sophos-xg.md","path":"infra/sophos-xg.md","contentType":"file"},{"name":"truenas-scale.md","path":"infra/truenas-scale.md","contentType":"file"},{"name":"zfs.md","path":"infra/zfs.md","contentType":"file"}],"totalCount":7},"":{"items":[{"name":".github","path":".github","contentType":"directory"},{"name":"apps","path":"apps","contentType":"directory"},{"name":"cloud","path":"cloud","contentType":"directory"},{"name":"databases","path":"databases","contentType":"directory"},{"name":"docker","path":"docker","contentType":"directory"},{"name":"hardware","path":"hardware","contentType":"directory"},{"name":"infra","path":"infra","contentType":"directory"},{"name":"kubernetes","path":"kubernetes","contentType":"directory"},{"name":"linux","path":"linux","contentType":"directory"},{"name":"macos","path":"macos","contentType":"directory"},{"name":"misc","path":"misc","contentType":"directory"},{"name":"networking","path":"networking","contentType":"directory"},{"name":"tools","path":"tools","contentType":"directory"},{"name":"windows","path":"windows","contentType":"directory"},{"name":".gitignore","path":".gitignore","contentType":"file"},{"name":"LICENSE","path":"LICENSE","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"},{"name":"SECURITY.md","path":"SECURITY.md","contentType":"file"}],"totalCount":18}},"fileTreeProcessingTime":5.135294,"foldersToFetch":[],"reducedMotionEnabled":"system","repo":{"id":402450742,"defaultBranch":"main","name":"cheat-sheets","ownerLogin":"ChristianLempa","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2021-09-02T07:27:23.000-07:00","ownerAvatar":"https://avatars.githubusercontent.com/u/28359525?v=4","public":true,"private":false,"isOrgOwned":false},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"main","listCacheKey":"v0:1695825574.0","canEdit":true,"refType":"branch","currentOid":"6c259e5e1ec2880a1197a2ce8f91fce3b2ac78d1"},"path":"infra/proxmox-certificate-management.md","currentUser":{"id":140017013,"login":"silkwat","userEmail":"silkwat@firemail.de"},"blob":{"rawLines":null,"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/ChristianLempa/cheat-sheets/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":false,"repoAlertsPath":"/ChristianLempa/cheat-sheets/security/dependabot","repoSecurityAndAnalysisPath":"/ChristianLempa/cheat-sheets/settings/security_analysis","repoOwnerIsOrg":false,"currentUserCanAdminRepo":false},"displayName":"proxmox-certificate-management.md","displayUrl":"https://github.com/ChristianLempa/cheat-sheets/blob/main/infra/proxmox-certificate-management.md?raw=true","headerInfo":{"blobSize":"13.9 KB","deleteInfo":{"deleteTooltip":"Fork this repository and delete the file"},"editInfo":{"editTooltip":"Fork this repository and edit the file"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"585b0df","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2FChristianLempa%2Fcheat-sheets%2Fblob%2Fmain%2Finfra%2Fproxmox-certificate-management.md","isCSV":false,"isRichtext":true,"toc":[{"level":1,"text":"Proxmox Certificate Management","anchor":"proxmox-certificate-management","htmlText":"Proxmox Certificate Management"},{"level":2,"text":"Certificates for Intra-Cluster Communication","anchor":"certificates-for-intra-cluster-communication","htmlText":"Certificates for Intra-Cluster Communication"},{"level":2,"text":"Certificates for API and Web GUI","anchor":"certificates-for-api-and-web-gui","htmlText":"Certificates for API and Web GUI"},{"level":2,"text":"Upload Custom Certificate","anchor":"upload-custom-certificate","htmlText":"Upload Custom Certificate"},{"level":2,"text":"Trusted certificates via Let's Encrypt (ACME)","anchor":"trusted-certificates-via-lets-encrypt-acme","htmlText":"Trusted certificates via Let's Encrypt (ACME)"},{"level":3,"text":"ACME Account","anchor":"acme-account","htmlText":"ACME Account"},{"level":3,"text":"ACME Plugins","anchor":"acme-plugins","htmlText":"ACME Plugins"},{"level":3,"text":"Node Domains","anchor":"node-domains","htmlText":"Node Domains"},{"level":2,"text":"ACME HTTP Challenge Plugin","anchor":"acme-http-challenge-plugin","htmlText":"ACME HTTP Challenge Plugin"},{"level":2,"text":"ACME DNS API Challenge Plugin","anchor":"acme-dns-api-challenge-plugin","htmlText":"ACME DNS API Challenge Plugin"},{"level":3,"text":"Configuring ACME DNS APIs for validation","anchor":"configuring-acme-dns-apis-for-validation","htmlText":"Configuring ACME DNS APIs for validation"},{"level":2,"text":"DNS Validation through CNAME Alias","anchor":"dns-validation-through-cname-alias","htmlText":"DNS Validation through CNAME Alias"},{"level":3,"text":"Combination of Plugins","anchor":"combination-of-plugins","htmlText":"Combination of Plugins"},{"level":2,"text":"Automatic renewal of ACME certificates","anchor":"automatic-renewal-of-acme-certificates","htmlText":"Automatic renewal of ACME certificates"},{"level":2,"text":"ACME Examples with pvenode","anchor":"acme-examples-with-pvenode","htmlText":"ACME Examples with pvenode"},{"level":3,"text":"Example: Switching from the staging to the regular ACME directory","anchor":"example-switching-from-the-staging-to-the-regular-acme-directory","htmlText":"Example: Switching from the staging to the regular ACME directory"}],"lineInfo":{"truncatedLoc":"315","truncatedSloc":"253"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Markdown","languageID":222,"large":false,"loggedIn":true,"newDiscussionPath":"/ChristianLempa/cheat-sheets/discussions/new","newIssuePath":"/ChristianLempa/cheat-sheets/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/ChristianLempa/cheat-sheets/blob/main/infra/proxmox-certificate-management.md","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/ChristianLempa/cheat-sheets/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"rawBlobUrl":"https://github.com/ChristianLempa/cheat-sheets/raw/main/infra/proxmox-certificate-management.md","renderImageOrRaw":false,"richText":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><h1 tabindex=\"-1\" id=\"user-content-proxmox-certificate-management\" dir=\"auto\"><a class=\"heading-link\" href=\"#proxmox-certificate-management\">Proxmox Certificate Management<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<h2 tabindex=\"-1\" id=\"user-content-certificates-for-intra-cluster-communication\" dir=\"auto\"><a class=\"heading-link\" href=\"#certificates-for-intra-cluster-communication\">Certificates for Intra-Cluster Communication<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">Each Proxmox VE cluster creates by default its own (self-signed) Certificate\nAuthority (CA) and generates a certificate for each node which gets signed by\nthe aforementioned CA. These certificates are used for encrypted communication\nwith the cluster's pveproxy service and the Shell/Console feature if SPICE is used.</p>\n<p dir=\"auto\">The CA certificate and key are stored in the Proxmox Cluster File System (pmxcfs).</p>\n<h2 tabindex=\"-1\" id=\"user-content-certificates-for-api-and-web-gui\" dir=\"auto\"><a class=\"heading-link\" href=\"#certificates-for-api-and-web-gui\">Certificates for API and Web GUI<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">The REST API and web GUI are provided by the pveproxy service, which runs on each node.\nYou have the following options for the certificate used by pveproxy:</p>\n<ul dir=\"auto\">\n<li>By default the node-specific certificate in <code>/etc/pve/nodes/NODENAME/pve-ssl.pem</code> is used. This certificate is signed by the cluster CA and therefore not automatically trusted by browsers and operating systems.</li>\n<li>Use an externally provided certificate (e.g. signed by a commercial CA).</li>\n<li>Use ACME (Let's Encrypt) to get a trusted certificate with automatic renewal, this is also integrated in the Proxmox VE API and web interface.</li>\n</ul>\n<p dir=\"auto\">For options 2 and 3 the file <code>/etc/pve/local/pveproxy-ssl.pem</code> (and\n<code>/etc/pve/local/pveproxy-ssl.key</code>, which needs to be without password) is used.\nKeep in mind that <code>/etc/pve/local</code> is a node specific symlink to\n<code>/etc/pve/nodes/NODENAME</code>.</p>\n<p dir=\"auto\">Certificates are managed with the Proxmox VE Node management command\n(see the <code>pvenode(1)</code> manpage).</p>\n<p dir=\"auto\">Do not replace or manually modify the automatically generated node\ncertificate files in <code>/etc/pve/local/pve-ssl.pem</code> and\n<code>/etc/pve/local/pve-ssl.key</code> or the cluster CA files in\n<code>/etc/pve/pve-root-ca.pem</code> and <code>/etc/pve/priv/pve-root-ca.key</code>.</p>\n<h2 tabindex=\"-1\" id=\"user-content-upload-custom-certificate\" dir=\"auto\"><a class=\"heading-link\" href=\"#upload-custom-certificate\">Upload Custom Certificate<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">If you already have a certificate which you want to use for a Proxmox VE node\nyou can upload that certificate simply over the web interface. Note that the\ncertificates key file, if provided, mustn't be password protected.</p>\n<h2 tabindex=\"-1\" id=\"user-content-trusted-certificates-via-lets-encrypt-acme\" dir=\"auto\"><a class=\"heading-link\" href=\"#trusted-certificates-via-lets-encrypt-acme\">Trusted certificates via Let's Encrypt (ACME)<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">Proxmox VE includes an implementation of the Automatic Certificate\nManagement Environment ACME protocol, allowing Proxmox VE admins to\nuse an ACME provider like Let's Encrypt for easy setup of TLS certificates\nwhich are accepted and trusted on modern operating systems and web browsers\nout of the box.</p>\n<p dir=\"auto\">Currently, the two ACME endpoints implemented are the\nLet's Encrypt (LE) production and its staging\nenvironment. Our ACME client supports validation of http-01 challenges using\na built-in web server and validation of dns-01 challenges using a DNS plugin\nsupporting all the DNS API endpoints <code>acme.sh</code> does.</p>\n<h3 tabindex=\"-1\" id=\"user-content-acme-account\" dir=\"auto\"><a class=\"heading-link\" href=\"#acme-account\">ACME Account<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">You need to register an ACME account per cluster with the endpoint you want to\nuse. The email address used for that account will serve as contact point for\nrenewal-due or similar notifications from the ACME endpoint.\nYou can register and deactivate ACME accounts over the web interface\n<code>Datacenter -&amp;gt; ACME</code> or using the <code>pvenode</code> command line tool.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\" pvenode acme account register account-name mail@example.com\"><pre> pvenode acme account register account-name mail@example.com</pre></div>\n<p dir=\"auto\">Because of rate-limits you should use LE staging for experiments or if you use\nACME for the first time.</p>\n<h3 tabindex=\"-1\" id=\"user-content-acme-plugins\" dir=\"auto\"><a class=\"heading-link\" href=\"#acme-plugins\">ACME Plugins<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">The ACME plugins task is to provide automatic verification that you, and thus\nthe Proxmox VE cluster under your operation, are the real owner of a domain. This is\nthe basis building block for automatic certificate management.</p>\n<p dir=\"auto\">The ACME protocol specifies different types of challenges, for example the\nhttp-01 where a web server provides a file with a certain content to prove\nthat it controls a domain. Sometimes this isn't possible, either because of\ntechnical limitations or if the address of a record to is not reachable from\nthe public internet. The dns-01 challenge can be used in these cases.  This\nchallenge is fulfilled by creating a certain DNS record in the domain's zone.</p>\n<p dir=\"auto\">Proxmox VE supports both of those challenge types out of the box, you can configure\nplugins either over the web interface under <code>Datacenter -&amp;gt; ACME</code>, or using the\n<code>pvenode acme plugin add</code> command.</p>\n<p dir=\"auto\">ACME Plugin configurations are stored in <code>/etc/pve/priv/acme/plugins.cfg</code>.\nA plugin is available for all nodes in the cluster.</p>\n<h3 tabindex=\"-1\" id=\"user-content-node-domains\" dir=\"auto\"><a class=\"heading-link\" href=\"#node-domains\">Node Domains<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Each domain is node specific. You can add new or manage existing domain entries\nunder Node -&gt; Certificates, or using the <code>pvenode config</code> command.</p>\n<p dir=\"auto\">After configuring the desired domain(s) for a node and ensuring that the\ndesired ACME account is selected, you can order your new certificate over the\nweb-interface. On success the interface will reload after 10 seconds.</p>\n<p dir=\"auto\">Renewal will happen automatically.</p>\n<h2 tabindex=\"-1\" id=\"user-content-acme-http-challenge-plugin\" dir=\"auto\"><a class=\"heading-link\" href=\"#acme-http-challenge-plugin\">ACME HTTP Challenge Plugin<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">There is always an implicitly configured standalone plugin for validating\nhttp-01 challenges via the built-in webserver spawned on port 80.</p>\n<p dir=\"auto\">The name <code>standalone</code> means that it can provide the validation on it's\nown, without any third party service. So, this plugin works also for cluster\nnodes.</p>\n<p dir=\"auto\">There are a few prerequisites to use it for certificate management with Let's\nEncrypts ACME.</p>\n<ul dir=\"auto\">\n<li>You have to accept the ToS of Let's Encrypt to register an account.</li>\n<li>Port 80 of the node needs to be reachable from the internet.</li>\n<li>There must be no other listener on port 80.</li>\n<li>The requested (sub)domain needs to resolve to a public IP of the Node.</li>\n</ul>\n<h2 tabindex=\"-1\" id=\"user-content-acme-dns-api-challenge-plugin\" dir=\"auto\"><a class=\"heading-link\" href=\"#acme-dns-api-challenge-plugin\">ACME DNS API Challenge Plugin<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">On systems where external access for validation via the http-01 method is\nnot possible or desired, it is possible to use the dns-01 validation method.\nThis validation method requires a DNS server that allows provisioning of TXT\nrecords via an API.</p>\n<h3 tabindex=\"-1\" id=\"user-content-configuring-acme-dns-apis-for-validation\" dir=\"auto\"><a class=\"heading-link\" href=\"#configuring-acme-dns-apis-for-validation\">Configuring ACME DNS APIs for validation<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Proxmox VE re-uses the DNS plugins developed for the\n<a href=\"https://github.com/acmesh-official/acme.sh\">acme.sh project</a>. Please\nrefer to its documentation for details on configuration of specific APIs.</p>\n<p dir=\"auto\">The easiest way to configure a new plugin with the DNS API is using the web\ninterface (<code>Datacenter -&amp;gt; ACME</code>).</p>\n<p dir=\"auto\">Choose DNS as challenge type. Then you can select your API provider, enter\nthe credential data to access your account over their API.</p>\n<p dir=\"auto\">See the <code>acme.sh</code>\n<a href=\"https://github.com/acmesh-official/acme.sh/wiki/dnsapi#how-to-use-dns-api\">How to use DNS API</a>\nwiki for more detailed information about getting API credentials for your\nprovider.</p>\n<p dir=\"auto\">As there are many DNS providers and API endpoints Proxmox VE automatically generates\nthe form for the credentials for some providers. For the others you will see a\nbigger text area, simply copy all the credentials KEY=VALUE pairs in there.</p>\n<h2 tabindex=\"-1\" id=\"user-content-dns-validation-through-cname-alias\" dir=\"auto\"><a class=\"heading-link\" href=\"#dns-validation-through-cname-alias\">DNS Validation through CNAME Alias<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">A special alias mode can be used to handle the validation on a different\ndomain/DNS server, in case your primary/real DNS does not support provisioning\nvia an API. Manually set up a permanent CNAME record for\n<code>_acme-challenge.domain1.example</code> pointing to <code>_acme-challenge.domain2.example</code>\nand set the alias property in the Proxmox VE node configuration file to\n<code>domain2.example</code> to allow the DNS server of <code>domain2.example</code> to validate all\nchallenges for <code>domain1.example</code>.</p>\n<h3 tabindex=\"-1\" id=\"user-content-combination-of-plugins\" dir=\"auto\"><a class=\"heading-link\" href=\"#combination-of-plugins\">Combination of Plugins<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Combining http-01 and dns-01 validation is possible in case your node is\nreachable via multiple domains with different requirements / DNS provisioning\ncapabilities. Mixing DNS APIs from multiple providers or instances is also\npossible by specifying different plugin instances per domain.\nAccessing the same service over multiple domains increases complexity and\nshould be avoided if possible.</p>\n<h2 tabindex=\"-1\" id=\"user-content-automatic-renewal-of-acme-certificates\" dir=\"auto\"><a class=\"heading-link\" href=\"#automatic-renewal-of-acme-certificates\">Automatic renewal of ACME certificates<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">If a node has been successfully configured with an ACME-provided certificate\n(either via <code>pvenode</code> or via the GUI), the certificate will be automatically\nrenewed by the <code>pve-daily-update.service</code>. Currently, renewal will be attempted\nif the certificate has expired already, or will expire in the next 30 days.</p>\n<h2 tabindex=\"-1\" id=\"user-content-acme-examples-with-pvenode\" dir=\"auto\"><a class=\"heading-link\" href=\"#acme-examples-with-pvenode\">ACME Examples with pvenode<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\"><em>Example</em>: Sample <code>pvenode</code> invocation for using Let's Encrypt certificates</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"root@proxmox:~# pvenode acme account register default mail@example.invalid\nDirectory endpoints:\n0) Let's Encrypt V2 (https://acme-v02.api.letsencrypt.org/directory)\n1) Let's Encrypt V2 Staging (https://acme-staging-v02.api.letsencrypt.org/directory)\n2) Custom\nEnter selection: 1\nTerms of Service: https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf\nDo you agree to the above terms? [y|N]y\n...\nTask OK\nroot@proxmox:~# pvenode config set --acme domains=example.invalid\nroot@proxmox:~# pvenode acme cert order\nLoading ACME account details\nPlacing ACME order\n...\nStatus is 'valid'!\nAll domains validated!\n...\nDownloading certificate\nSetting pveproxy certificate and key\nRestarting pveproxy\nTask OK\"><pre>root@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode acme account register default mail@example.invalid</span>\nDirectory endpoints:\n0) Let<span class=\"pl-s\"><span class=\"pl-pds\">'</span>s Encrypt V2 (https://acme-v02.api.letsencrypt.org/directory)</span>\n<span class=\"pl-s\">1) Let<span class=\"pl-pds\">'</span></span>s Encrypt V2 Staging (https://acme-staging-v02.api.letsencrypt.org/directory)\n2) Custom\nEnter selection: 1\nTerms of Service: https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf\nDo you agree to the above terms<span class=\"pl-k\">?</span> [y<span class=\"pl-k\">|</span>N]y\n...\nTask OK\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode config set --acme domains=example.invalid</span>\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode acme cert order</span>\nLoading ACME account details\nPlacing ACME order\n...\nStatus is <span class=\"pl-s\"><span class=\"pl-pds\">'</span>valid<span class=\"pl-pds\">'</span></span><span class=\"pl-k\">!</span>\nAll domains validated<span class=\"pl-k\">!</span>\n...\nDownloading certificate\nSetting pveproxy certificate and key\nRestarting pveproxy\nTask OK</pre></div>\n<p dir=\"auto\"><em>Example</em>: Setting up the OVH API for validating a domain</p>\n<p dir=\"auto\">The account registration steps are the same no matter which plugins are\nused, and are not repeated here.</p>\n<p dir=\"auto\">OVH_AK and OVH_AS need to be obtained from OVH according to the OVH\nAPI documentation</p>\n<p dir=\"auto\">First you need to get all information so you and Proxmox VE can access the API.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"root@proxmox:~# cat /path/to/api-token\nOVH_AK=XXXXXXXXXXXXXXXX\nOVH_AS=YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY\nroot@proxmox:~# source /path/to/api-token\nroot@proxmox:~# curl -XPOST -H&quot;X-Ovh-Application: $OVH_AK&quot; -H &quot;Content-type: application/json&quot; \\\nhttps://eu.api.ovh.com/1.0/auth/credential  -d '{\n  &quot;accessRules&quot;: [\n    {&quot;method&quot;: &quot;GET&quot;,&quot;path&quot;: &quot;/auth/time&quot;},\n    {&quot;method&quot;: &quot;GET&quot;,&quot;path&quot;: &quot;/domain&quot;},\n    {&quot;method&quot;: &quot;GET&quot;,&quot;path&quot;: &quot;/domain/zone/*&quot;},\n    {&quot;method&quot;: &quot;GET&quot;,&quot;path&quot;: &quot;/domain/zone/*/record&quot;},\n    {&quot;method&quot;: &quot;POST&quot;,&quot;path&quot;: &quot;/domain/zone/*/record&quot;},\n    {&quot;method&quot;: &quot;POST&quot;,&quot;path&quot;: &quot;/domain/zone/*/refresh&quot;},\n    {&quot;method&quot;: &quot;PUT&quot;,&quot;path&quot;: &quot;/domain/zone/*/record/&quot;},\n    {&quot;method&quot;: &quot;DELETE&quot;,&quot;path&quot;: &quot;/domain/zone/*/record/*&quot;}\n]\n}'\n{&quot;consumerKey&quot;:&quot;ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ&quot;,&quot;state&quot;:&quot;pendingValidation&quot;,&quot;validationUrl&quot;:&quot;https://eu.api.ovh.com/auth/?credentialToken=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;}\n(open validation URL and follow instructions to link Application Key with account/Consumer Key)\nroot@proxmox:~# echo &quot;OVH_CK=ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ&quot; &amp;gt;&amp;gt; /path/to/api-token\"><pre>root@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> cat /path/to/api-token</span>\nOVH_AK=XXXXXXXXXXXXXXXX\nOVH_AS=YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> source /path/to/api-token</span>\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> curl -XPOST -H\"X-Ovh-Application: $OVH_AK\" -H \"Content-type: application/json\" \\</span>\nhttps://eu.api.ovh.com/1.0/auth/credential  -d <span class=\"pl-s\"><span class=\"pl-pds\">'</span>{</span>\n<span class=\"pl-s\">  \"accessRules\": [</span>\n<span class=\"pl-s\">    {\"method\": \"GET\",\"path\": \"/auth/time\"},</span>\n<span class=\"pl-s\">    {\"method\": \"GET\",\"path\": \"/domain\"},</span>\n<span class=\"pl-s\">    {\"method\": \"GET\",\"path\": \"/domain/zone/*\"},</span>\n<span class=\"pl-s\">    {\"method\": \"GET\",\"path\": \"/domain/zone/*/record\"},</span>\n<span class=\"pl-s\">    {\"method\": \"POST\",\"path\": \"/domain/zone/*/record\"},</span>\n<span class=\"pl-s\">    {\"method\": \"POST\",\"path\": \"/domain/zone/*/refresh\"},</span>\n<span class=\"pl-s\">    {\"method\": \"PUT\",\"path\": \"/domain/zone/*/record/\"},</span>\n<span class=\"pl-s\">    {\"method\": \"DELETE\",\"path\": \"/domain/zone/*/record/*\"}</span>\n<span class=\"pl-s\">]</span>\n<span class=\"pl-s\">}<span class=\"pl-pds\">'</span></span>\n{<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>consumerKey<span class=\"pl-pds\">\"</span></span>:<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ<span class=\"pl-pds\">\"</span></span>,<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>state<span class=\"pl-pds\">\"</span></span>:<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>pendingValidation<span class=\"pl-pds\">\"</span></span>,<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>validationUrl<span class=\"pl-pds\">\"</span></span>:<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>https://eu.api.ovh.com/auth/?credentialToken=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA<span class=\"pl-pds\">\"</span></span>}\n(open validation URL and follow instructions to link Application Key with account/Consumer Key)\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> echo \"OVH_CK=ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ\" &amp;gt;&amp;gt; /path/to/api-token</span></pre></div>\n<p dir=\"auto\">Now you can setup the ACME plugin:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"root@proxmox:~# pvenode acme plugin add dns example_plugin --api ovh --data /path/to/api_token\nroot@proxmox:~# pvenode acme plugin config example_plugin\n```sh\n&lt;pre&gt;\n┌────────┬──────────────────────────────────────────┐\n│ key    │ value                                    │\n╞════════╪══════════════════════════════════════════╡\n│ api    │ ovh                                      │\n├────────┼──────────────────────────────────────────┤\n│ data   │ OVH_AK=XXXXXXXXXXXXXXXX                  │\n│        │ OVH_AS=YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY  │\n│        │ OVH_CK=ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ  │\n├────────┼──────────────────────────────────────────┤\n│ digest │ 867fcf556363ca1bea866863093fcab83edf47a1 │\n├────────┼──────────────────────────────────────────┤\n│ plugin │ example_plugin                           │\n├────────┼──────────────────────────────────────────┤\n│ type   │ dns                                      │\n└────────┴──────────────────────────────────────────┘\n&lt;/pre&gt;\n\nAt last you can configure the domain you want to get certificates for and\nplace the certificate order for it:\n\n```sh\nroot@proxmox:~# pvenode config set -acmedomain0 example.proxmox.com,plugin=example_plugin\nroot@proxmox:~# pvenode acme cert order\nLoading ACME account details\nPlacing ACME order\nOrder URL: https://acme-staging-v02.api.letsencrypt.org/acme/order/11111111/22222222\nGetting authorization details from 'https://acme-staging-v02.api.letsencrypt.org/acme/authz-v3/33333333'\nThe validation for example.proxmox.com is pending!\n[Wed Apr 22 09:25:30 CEST 2020] Using OVH endpoint: ovh-eu\n[Wed Apr 22 09:25:30 CEST 2020] Checking authentication\n[Wed Apr 22 09:25:30 CEST 2020] Consumer key is ok.\n[Wed Apr 22 09:25:31 CEST 2020] Adding record\n[Wed Apr 22 09:25:32 CEST 2020] Added, sleep 10 seconds.\nAdd TXT record: _acme-challenge.example.proxmox.com\nTriggering validation\nSleeping for 5 seconds\nStatus is 'valid'!\n[Wed Apr 22 09:25:48 CEST 2020] Using OVH endpoint: ovh-eu\n[Wed Apr 22 09:25:48 CEST 2020] Checking authentication\n[Wed Apr 22 09:25:48 CEST 2020] Consumer key is ok.\nRemove TXT record: _acme-challenge.example.proxmox.com\nAll domains validated!\nCreating CSR\nChecking order status\nOrder is ready, finalizing order\nvalid!\nDownloading certificate\nSetting pveproxy certificate and key\nRestarting pveproxy\nTask OK\"><pre>root@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode acme plugin add dns example_plugin --api ovh --data /path/to/api_token</span>\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode acme plugin config example_plugin</span>\n<span class=\"pl-s\"><span class=\"pl-pds\">`</span><span class=\"pl-pds\">`</span><span class=\"pl-pds\">`</span>sh</span>\n<span class=\"pl-s\"><span class=\"pl-k\">&lt;</span>pre<span class=\"pl-k\">&gt;</span></span>\n<span class=\"pl-s\">┌────────┬──────────────────────────────────────────┐</span>\n<span class=\"pl-s\">│ key    │ value                                    │</span>\n<span class=\"pl-s\">╞════════╪══════════════════════════════════════════╡</span>\n<span class=\"pl-s\">│ api    │ ovh                                      │</span>\n<span class=\"pl-s\">├────────┼──────────────────────────────────────────┤</span>\n<span class=\"pl-s\">│ data   │ OVH_AK=XXXXXXXXXXXXXXXX                  │</span>\n<span class=\"pl-s\">│        │ OVH_AS=YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY  │</span>\n<span class=\"pl-s\">│        │ OVH_CK=ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ  │</span>\n<span class=\"pl-s\">├────────┼──────────────────────────────────────────┤</span>\n<span class=\"pl-s\">│ digest │ 867fcf556363ca1bea866863093fcab83edf47a1 │</span>\n<span class=\"pl-s\">├────────┼──────────────────────────────────────────┤</span>\n<span class=\"pl-s\">│ plugin │ example_plugin                           │</span>\n<span class=\"pl-s\">├────────┼──────────────────────────────────────────┤</span>\n<span class=\"pl-s\">│ <span class=\"pl-c1\">type</span>   │ dns                                      │</span>\n<span class=\"pl-s\">└────────┴──────────────────────────────────────────┘</span>\n<span class=\"pl-s\"><span class=\"pl-k\">&lt;</span>/pre<span class=\"pl-k\">&gt;</span></span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\">At last you can configure the domain you want to get certificates <span class=\"pl-k\">for</span> and</span>\n<span class=\"pl-s\">place the certificate order <span class=\"pl-k\">for</span> it:</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\"><span class=\"pl-pds\">`</span><span class=\"pl-pds\">`</span><span class=\"pl-pds\">`</span></span>sh\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode config set -acmedomain0 example.proxmox.com,plugin=example_plugin</span>\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode acme cert order</span>\nLoading ACME account details\nPlacing ACME order\nOrder URL: https://acme-staging-v02.api.letsencrypt.org/acme/order/11111111/22222222\nGetting authorization details from <span class=\"pl-s\"><span class=\"pl-pds\">'</span>https://acme-staging-v02.api.letsencrypt.org/acme/authz-v3/33333333<span class=\"pl-pds\">'</span></span>\nThe validation <span class=\"pl-k\">for</span> example.proxmox.com is pending<span class=\"pl-k\">!</span>\n[Wed Apr 22 09:25:30 CEST 2020] Using OVH endpoint: ovh-eu\n[Wed Apr 22 09:25:30 CEST 2020] Checking authentication\n[Wed Apr 22 09:25:30 CEST 2020] Consumer key is ok.\n[Wed Apr 22 09:25:31 CEST 2020] Adding record\n[Wed Apr 22 09:25:32 CEST 2020] Added, sleep 10 seconds.\nAdd TXT record: _acme-challenge.example.proxmox.com\nTriggering validation\nSleeping <span class=\"pl-k\">for</span> 5 seconds\nStatus is <span class=\"pl-s\"><span class=\"pl-pds\">'</span>valid<span class=\"pl-pds\">'</span></span><span class=\"pl-k\">!</span>\n[Wed Apr 22 09:25:48 CEST 2020] Using OVH endpoint: ovh-eu\n[Wed Apr 22 09:25:48 CEST 2020] Checking authentication\n[Wed Apr 22 09:25:48 CEST 2020] Consumer key is ok.\nRemove TXT record: _acme-challenge.example.proxmox.com\nAll domains validated<span class=\"pl-k\">!</span>\nCreating CSR\nChecking order status\nOrder is ready, finalizing order\nvalid<span class=\"pl-k\">!</span>\nDownloading certificate\nSetting pveproxy certificate and key\nRestarting pveproxy\nTask OK</pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-example-switching-from-the-staging-to-the-regular-acme-directory\" dir=\"auto\"><a class=\"heading-link\" href=\"#example-switching-from-the-staging-to-the-regular-acme-directory\">Example: Switching from the staging to the regular ACME directory<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Changing the ACME directory for an account is unsupported, but as Proxmox VE\nsupports more than one account you can just create a new one with the\nproduction (trusted) ACME directory as endpoint.  You can also deactivate the\nstaging account and recreate it.</p>\n<p dir=\"auto\"><em>Example</em>: Changing the default ACME account from staging to directory using <code>pvenode</code></p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"root@proxmox:~# pvenode acme account deactivate default\nRenaming account file from '/etc/pve/priv/acme/default' to '/etc/pve/priv/acme/_deactivated_default_4'\nTask OK\nroot@proxmox:~# pvenode acme account register default example@proxmox.com\nDirectory endpoints:\n0) Let's Encrypt V2 (https://acme-v02.api.letsencrypt.org/directory)\n1) Let's Encrypt V2 Staging (https://acme-staging-v02.api.letsencrypt.org/directory)\n2) Custom\nEnter selection: 0\nTerms of Service: https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf\nDo you agree to the above terms? [y|N]y\n...\nTask OK\"><pre>root@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode acme account deactivate default</span>\nRenaming account file from <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/etc/pve/priv/acme/default<span class=\"pl-pds\">'</span></span> to <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/etc/pve/priv/acme/_deactivated_default_4<span class=\"pl-pds\">'</span></span>\nTask OK\nroot@proxmox:<span class=\"pl-k\">~</span><span class=\"pl-c\"><span class=\"pl-c\">#</span> pvenode acme account register default example@proxmox.com</span>\nDirectory endpoints:\n0) Let<span class=\"pl-s\"><span class=\"pl-pds\">'</span>s Encrypt V2 (https://acme-v02.api.letsencrypt.org/directory)</span>\n<span class=\"pl-s\">1) Let<span class=\"pl-pds\">'</span></span>s Encrypt V2 Staging (https://acme-staging-v02.api.letsencrypt.org/directory)\n2) Custom\nEnter selection: 0\nTerms of Service: https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf\nDo you agree to the above terms<span class=\"pl-k\">?</span> [y<span class=\"pl-k\">|</span>N]y\n...\nTask OK</pre></div>\n</article>","renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"ChristianLempa","repoName":"cheat-sheets","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":false,"symbols":[{"name":" Proxmox Certificate Management","kind":"section_1","identStart":1,"identEnd":32,"extentStart":0,"extentEnd":14263,"fullyQualifiedName":" Proxmox Certificate Management","identUtf16":{"start":{"lineNumber":0,"utf16Col":1},"end":{"lineNumber":0,"utf16Col":32}},"extentUtf16":{"start":{"lineNumber":0,"utf16Col":0},"end":{"lineNumber":315,"utf16Col":0}}},{"name":" Certificates for Intra-Cluster Communication","kind":"section_2","identStart":36,"identEnd":81,"extentStart":34,"extentEnd":486,"fullyQualifiedName":" Certificates for Intra-Cluster Communication","identUtf16":{"start":{"lineNumber":2,"utf16Col":2},"end":{"lineNumber":2,"utf16Col":47}},"extentUtf16":{"start":{"lineNumber":2,"utf16Col":0},"end":{"lineNumber":11,"utf16Col":0}}},{"name":" Certificates for API and Web GUI","kind":"section_2","identStart":488,"identEnd":521,"extentStart":486,"extentEnd":1700,"fullyQualifiedName":" Certificates for API and Web GUI","identUtf16":{"start":{"lineNumber":11,"utf16Col":2},"end":{"lineNumber":11,"utf16Col":35}},"extentUtf16":{"start":{"lineNumber":11,"utf16Col":0},"end":{"lineNumber":33,"utf16Col":0}}},{"name":" Upload Custom Certificate","kind":"section_2","identStart":1702,"identEnd":1728,"extentStart":1700,"extentEnd":1953,"fullyQualifiedName":" Upload Custom Certificate","identUtf16":{"start":{"lineNumber":33,"utf16Col":2},"end":{"lineNumber":33,"utf16Col":28}},"extentUtf16":{"start":{"lineNumber":33,"utf16Col":0},"end":{"lineNumber":39,"utf16Col":0}}},{"name":" Trusted certificates via Let's Encrypt (ACME)","kind":"section_2","identStart":1955,"identEnd":2001,"extentStart":1953,"extentEnd":4625,"fullyQualifiedName":" Trusted certificates via Let's Encrypt (ACME)","identUtf16":{"start":{"lineNumber":39,"utf16Col":2},"end":{"lineNumber":39,"utf16Col":48}},"extentUtf16":{"start":{"lineNumber":39,"utf16Col":0},"end":{"lineNumber":99,"utf16Col":0}}},{"name":" ACME Account","kind":"section_3","identStart":2617,"identEnd":2630,"extentStart":2614,"extentEnd":3165,"fullyQualifiedName":" ACME Account","identUtf16":{"start":{"lineNumber":53,"utf16Col":3},"end":{"lineNumber":53,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":53,"utf16Col":0},"end":{"lineNumber":68,"utf16Col":0}}},{"name":" ACME Plugins","kind":"section_3","identStart":3168,"identEnd":3181,"extentStart":3165,"extentEnd":4198,"fullyQualifiedName":" ACME Plugins","identUtf16":{"start":{"lineNumber":68,"utf16Col":3},"end":{"lineNumber":68,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":68,"utf16Col":0},"end":{"lineNumber":88,"utf16Col":0}}},{"name":" Node Domains","kind":"section_3","identStart":4201,"identEnd":4214,"extentStart":4198,"extentEnd":4625,"fullyQualifiedName":" Node Domains","identUtf16":{"start":{"lineNumber":88,"utf16Col":3},"end":{"lineNumber":88,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":88,"utf16Col":0},"end":{"lineNumber":99,"utf16Col":0}}},{"name":" ACME HTTP Challenge Plugin","kind":"section_2","identStart":4627,"identEnd":4654,"extentStart":4625,"extentEnd":5300,"fullyQualifiedName":" ACME HTTP Challenge Plugin","identUtf16":{"start":{"lineNumber":99,"utf16Col":2},"end":{"lineNumber":99,"utf16Col":29}},"extentUtf16":{"start":{"lineNumber":99,"utf16Col":0},"end":{"lineNumber":116,"utf16Col":0}}},{"name":" ACME DNS API Challenge Plugin","kind":"section_2","identStart":5302,"identEnd":5332,"extentStart":5300,"extentEnd":6516,"fullyQualifiedName":" ACME DNS API Challenge Plugin","identUtf16":{"start":{"lineNumber":116,"utf16Col":2},"end":{"lineNumber":116,"utf16Col":32}},"extentUtf16":{"start":{"lineNumber":116,"utf16Col":0},"end":{"lineNumber":144,"utf16Col":0}}},{"name":" Configuring ACME DNS APIs for validation","kind":"section_3","identStart":5586,"identEnd":5627,"extentStart":5583,"extentEnd":6516,"fullyQualifiedName":" Configuring ACME DNS APIs for validation","identUtf16":{"start":{"lineNumber":123,"utf16Col":3},"end":{"lineNumber":123,"utf16Col":44}},"extentUtf16":{"start":{"lineNumber":123,"utf16Col":0},"end":{"lineNumber":144,"utf16Col":0}}},{"name":" DNS Validation through CNAME Alias","kind":"section_2","identStart":6518,"identEnd":6553,"extentStart":6516,"extentEnd":7452,"fullyQualifiedName":" DNS Validation through CNAME Alias","identUtf16":{"start":{"lineNumber":144,"utf16Col":2},"end":{"lineNumber":144,"utf16Col":37}},"extentUtf16":{"start":{"lineNumber":144,"utf16Col":0},"end":{"lineNumber":163,"utf16Col":0}}},{"name":" Combination of Plugins","kind":"section_3","identStart":7033,"identEnd":7056,"extentStart":7030,"extentEnd":7452,"fullyQualifiedName":" Combination of Plugins","identUtf16":{"start":{"lineNumber":154,"utf16Col":3},"end":{"lineNumber":154,"utf16Col":26}},"extentUtf16":{"start":{"lineNumber":154,"utf16Col":0},"end":{"lineNumber":163,"utf16Col":0}}},{"name":" Automatic renewal of ACME certificates","kind":"section_2","identStart":7454,"identEnd":7493,"extentStart":7452,"extentEnd":7806,"fullyQualifiedName":" Automatic renewal of ACME certificates","identUtf16":{"start":{"lineNumber":163,"utf16Col":2},"end":{"lineNumber":163,"utf16Col":41}},"extentUtf16":{"start":{"lineNumber":163,"utf16Col":0},"end":{"lineNumber":170,"utf16Col":0}}},{"name":" ACME Examples with pvenode","kind":"section_2","identStart":7808,"identEnd":7835,"extentStart":7806,"extentEnd":14263,"fullyQualifiedName":" ACME Examples with pvenode","identUtf16":{"start":{"lineNumber":170,"utf16Col":2},"end":{"lineNumber":170,"utf16Col":29}},"extentUtf16":{"start":{"lineNumber":170,"utf16Col":0},"end":{"lineNumber":315,"utf16Col":0}}},{"name":" Example: Switching from the staging to the regular ACME directory","kind":"section_3","identStart":13257,"identEnd":13323,"extentStart":13254,"extentEnd":14263,"fullyQualifiedName":" Example: Switching from the staging to the regular ACME directory","identUtf16":{"start":{"lineNumber":291,"utf16Col":3},"end":{"lineNumber":291,"utf16Col":69}},"extentUtf16":{"start":{"lineNumber":291,"utf16Col":0},"end":{"lineNumber":315,"utf16Col":0}}}]}},"copilotInfo":{"documentationUrl":"https://docs.github.com/copilot/overview-of-github-copilot/about-github-copilot-for-individuals","notices":{"codeViewPopover":{"dismissed":false,"dismissPath":"/settings/dismiss-notice/code_view_copilot_popover"}},"userAccess":{"accessAllowed":false,"hasSubscriptionEnded":false,"orgHasCFBAccess":false,"userHasCFIAccess":false,"userHasOrgs":false,"userIsOrgAdmin":false,"userIsOrgMember":false,"business":null,"featureRequestInfo":null}},"csrf_tokens":{"/ChristianLempa/cheat-sheets/branches":{"post":"Dr0EbXt_McpenIvMvBeuFCv_xZA7uMtbiC2lF4ofVeBqZvwH0eEw2Y9lxUgGl34ALJOFSS9IrYcC_tLj5_WpnA"},"/repos/preferences":{"post":"J-UcEkwT9vzOo8VxkeWAfpJJ8gfPFmaDH9dpM5ssv5naUDEuEa-0j0olnz1Yga8jwrjMm1mdaj8OIP4vMxnjrQ"}}},"title":"cheat-sheets/infra/proxmox-certificate-management.md at main · ChristianLempa/cheat-sheets"}